<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaBunny - Player</title>

    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/theme.css">
    <link rel="stylesheet" href="assets/css/player.css">
    <link rel="stylesheet" href="assets/css/screenshot.css">
    <link rel="stylesheet" href="assets/css/player_page.css">
</head>

<body>

    <div class="player-layout">
        <!-- Video Section -->
        <main class="video-section" id="player-container">
            <!-- Core Player will be injected here -->
        </main>

        <!-- Mobile Playlist Toggle -->
        <button id="playlist-toggle" class="btn btn-icon" aria-label="Toggle Playlist"
            style="position: fixed; bottom: 20px; right: 20px; z-index: 110; display: none;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
            </svg>
        </button>

        <!-- Overlay for mobile drawer -->
        <div class="playlist-overlay" id="playlist-overlay"></div>

        <!-- Playlist Section -->
        <aside class="playlist-section">
            <header class="playlist-header" style="display: none;">
                <!-- Header is now generated by Playlist.js -->
            </header>
            <div class="playlist-content">
                <div class="playlist-placeholder">
                    <p>No videos in playlist.</p>
                    <p class="text-sm mt-2">Drag & drop files here.</p>
                </div>
            </div>
        </aside>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { CorePlayer } from './assets/js/core/Player.js';
        import { Playlist } from './assets/js/player/Playlist.js';

        // Initialize Player
        const player = new CorePlayer('player-container', {
            autoplay: false,
            muted: false,
            mode: 'player'
        });

        // Initialize Playlist
        const playlistContainer = document.querySelector('.playlist-content');
        const playlist = new Playlist(playlistContainer, player);

        // File Upload Handling is now managed by Playlist.js internally

        // Sample Data
        const sampleVideos = [
            {
                title: "Big Buck Bunny",
                url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
                duration: "9:56",
                thumbnail: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Big_buck_bunny_poster_big.jpg/320px-Big_buck_bunny_poster_big.jpg"
            },
            {
                title: "Elephant Dream",
                url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4",
                duration: "10:53",
                thumbnail: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/0c/ElephantsDreamPoster.jpg/320px-ElephantsDreamPoster.jpg"
            },
            {
                title: "For Bigger Blazes",
                url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4",
                duration: "0:15",
                thumbnail: "" // Test placeholder
            },
            {
                title: "For Bigger Escapes",
                url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4",
                duration: "0:15",
                thumbnail: ""
            }
        ];

        // Load samples only if playlist is empty (first run)
        if (playlist.items.length === 0) {
            playlist.addItems(sampleVideos);
            playlist.selectItem(0);
        }

        // Mobile Playlist Toggle
        const playlistToggle = document.getElementById('playlist-toggle');
        const playlistSection = document.querySelector('.playlist-section');
        const playlistOverlay = document.getElementById('playlist-overlay');

        function updatePlaylistToggle() {
            if (window.innerWidth <= 768) {
                playlistToggle.style.display = 'block';
            } else {
                playlistToggle.style.display = 'none';
                playlistSection.classList.remove('open');
                playlistOverlay.classList.remove('visible');
            }
        }

        updatePlaylistToggle();
        window.addEventListener('resize', updatePlaylistToggle);

        playlistToggle.addEventListener('click', () => {
            playlistSection.classList.toggle('open');
            playlistOverlay.classList.toggle('visible');
        });

        playlistOverlay.addEventListener('click', () => {
            playlistSection.classList.remove('open');
            playlistOverlay.classList.remove('visible');
        });
    </script>

</body>

</html>