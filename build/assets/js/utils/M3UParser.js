export class M3UParser{static parse(t){const e=t.split("\n").map(t=>t.trim()).filter(t=>t),r=[];e[0]?.toUpperCase().startsWith("#EXTM3U")||console.warn("[M3U] Invalid M3U file - missing #EXTM3U header");let n=null;for(let t=0;t<e.length;t++){const i=e[t];i.startsWith("#EXTINF:")?n=this._parseExtInf(i):i&&!i.startsWith("#")&&n&&(r.push({...n,url:i,id:this._generateId()}),n=null)}return r}static _parseExtInf(t){const e={duration:-1,name:"",logo:"",group:"",tvgId:"",tvgName:"",language:"",country:""},r=t.match(/#EXTINF:(-?\d+)/);r&&(e.duration=parseInt(r[1],10));const n={"tvg-id":"tvgId","tvg-name":"tvgName","tvg-logo":"logo","group-title":"group","tvg-language":"language","tvg-country":"country"};for(const[r,i]of Object.entries(n)){const n=new RegExp(`${r}="([^"]*)"`,"i"),s=t.match(n);s&&(e[i]=s[1])}const i=t.match(/,(.+)$/);return i&&(e.name=i[1].trim()),!e.name&&e.tvgName&&(e.name=e.tvgName),e}static _generateId(){return"ch_"+Math.random().toString(36).substr(2,9)}static async fetchAndParse(t){const e=await fetch(t);if(!e.ok)throw new Error(`Failed to fetch M3U: ${e.statusText}`);const r=await e.text();return this.parse(r)}static groupByCategory(t){return t.reduce((t,e)=>{const r=e.group||"Uncategorized";return t[r]||(t[r]=[]),t[r].push(e),t},{})}static groupByCountry(t){return t.reduce((t,e)=>{const r=e.country||"Unknown";return t[r]||(t[r]=[]),t[r].push(e),t},{})}static search(t,e){if(!e)return t;const r=e.toLowerCase();return t.filter(t=>t.name.toLowerCase().includes(r)||t.group.toLowerCase().includes(r)||t.tvgName.toLowerCase().includes(r))}static getSamplePlaylists(){return[{name:"IPTV-Org (All Countries)",url:"https://iptv-org.github.io/iptv/index.m3u",description:"Community-maintained collection of worldwide channels"},{name:"IPTV-Org (India)",url:"https://iptv-org.github.io/iptv/countries/in.m3u",description:"Indian TV channels"},{name:"IPTV-Org (USA)",url:"https://iptv-org.github.io/iptv/countries/us.m3u",description:"US TV channels"},{name:"IPTV-Org (UK)",url:"https://iptv-org.github.io/iptv/countries/uk.m3u",description:"UK TV channels"},{name:"IPTV-Org (News)",url:"https://iptv-org.github.io/iptv/categories/news.m3u",description:"News channels worldwide"},{name:"IPTV-Org (Sports)",url:"https://iptv-org.github.io/iptv/categories/sports.m3u",description:"Sports channels worldwide"},{name:"IPTV-Org (Entertainment)",url:"https://iptv-org.github.io/iptv/categories/entertainment.m3u",description:"Entertainment channels worldwide"}]}}