export class FileDropHandler{constructor(e,t){this.container=e,this.onFilesDropped=t,this.boundHandlers=new Map,this._attachEvents()}_attachEvents(){const e=this.container.closest(".playlist-section")||this.container,t=e=>{e.preventDefault(),e.stopPropagation()};["dragenter","dragover","dragleave","drop"].forEach(s=>{const r=t;e.addEventListener(s,r,!1),this.boundHandlers.set(`prevent-${s}`,r)});const s=()=>e.classList.add("drag-over");["dragenter","dragover"].forEach(t=>{e.addEventListener(t,s,!1),this.boundHandlers.set(`highlight-${t}`,s)});const r=()=>e.classList.remove("drag-over");["dragleave","drop"].forEach(t=>{e.addEventListener(t,r,!1),this.boundHandlers.set(`unhighlight-${t}`,r)});const n=async e=>{const t=e.dataTransfer,s=t.items;if(s){const e=[],t=[];for(let r=0;r<s.length;r++){const n=s[r].webkitGetAsEntry?s[r].webkitGetAsEntry():null;n?t.push(FileDropHandler.scanEntry(n)):"file"===s[r].kind&&e.push(s[r].getAsFile())}const r=(await Promise.all(t)).flat(),n=[...e,...r];this.onFilesDropped(n)}else this.onFilesDropped(Array.from(t.files))};e.addEventListener("drop",n,!1),this.boundHandlers.set("drop",n),this.section=e}static scanEntry(e){return new Promise(t=>{if(e.isFile)e.file(s=>{!s.webkitRelativePath&&e.fullPath&&Object.defineProperty(s,"webkitRelativePath",{value:e.fullPath.substring(1)}),t([s])});else if(e.isDirectory){e.createReader().readEntries(async e=>{const s=e.map(e=>FileDropHandler.scanEntry(e)),r=await Promise.all(s);t(r.flat())})}else t([])})}destroy(){if(!this.section)return;["dragenter","dragover","dragleave","drop"].forEach(e=>{const t=this.boundHandlers.get(`prevent-${e}`);t&&this.section.removeEventListener(e,t,!1)}),["dragenter","dragover"].forEach(e=>{const t=this.boundHandlers.get(`highlight-${e}`);t&&this.section.removeEventListener(e,t,!1)}),["dragleave","drop"].forEach(e=>{const t=this.boundHandlers.get(`unhighlight-${e}`);t&&this.section.removeEventListener(e,t,!1)});const e=this.boundHandlers.get("drop");e&&this.section.removeEventListener("drop",e,!1),this.boundHandlers.clear(),this.section=null}}