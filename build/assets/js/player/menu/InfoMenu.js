import{Modal}from"../Modal.js";import{MediaProcessor}from"../../core/MediaProcessor.js";export class InfoMenu{static async init(o,e){const n=document.getElementById("info-content-template"),t=document.getElementById("info-footer-template");if(!n)return;const a=new Modal({maxWidth:"600px"});a.setTitle("Video Information"),a.setBody(n.content.cloneNode(!0)),t&&a.setFooter(t.content.cloneNode(!0));const i=a.modal,d=i.querySelector(".info-loading"),r=i.querySelector(".info-modal-content"),c=i.querySelectorAll(".copy-btn"),s=i.querySelector(".copy-all-btn");a.open();try{await e._ensureMetadata(o);const n=(o,e=1)=>{if(0===o)return"0 Bytes";const n=e<0?0:e,t=Math.floor(Math.log(o)/Math.log(1024));return parseFloat((o/Math.pow(1024,t)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB"][t]};let t="0 Bytes";if(o.file)t=n(o.file.size);else if(o.url)try{const e=(await fetch(o.url,{method:"HEAD"})).headers.get("content-length");e&&(t=n(parseInt(e)))}catch(o){t="Unknown"}let c="Unknown",s="Unknown";o.videoInfo&&(o.videoInfo.fps&&(c=`${o.videoInfo.fps} fps`),o.videoInfo.bitrate&&(s=`${(o.videoInfo.bitrate/1e6).toFixed(1)} Mbps`));const l={filename:o.title,format:o.file?o.file.type.split("/")[0]:"Unknown",mimeType:o.file?o.file.type:"Unknown",size:t,duration:o.duration||"Unknown",videoCodec:o.videoInfo?o.videoInfo.codec.toUpperCase():"N/A",videoCodecString:o.videoInfo?o.videoInfo.codec:"N/A",resolution:o.videoInfo?`${o.videoInfo.width}x${o.videoInfo.height}`:"N/A",codedResolution:o.videoInfo?`${o.videoInfo.codedWidth}x${o.videoInfo.codedHeight}`:"N/A",fps:c,videoBitrate:s,rotation:o.videoInfo?`${o.videoInfo.rotation}Â°`:"N/A",hdr:o.videoInfo?o.videoInfo.hasHDR?"Yes":"No":"N/A",audioCodec:o.audioInfo?o.audioInfo.codec.toUpperCase():"N/A",audioCodecString:o.audioInfo?o.audioInfo.codec:"N/A",channels:o.audioInfo?2===o.audioInfo.channels?"Stereo (2)":`${o.audioInfo.channels} Channels`:"N/A",sampleRate:o.audioInfo?`${(o.audioInfo.sampleRate/1e3).toFixed(1)} kHz`:"N/A",language:o.audioInfo?"und"===o.audioInfo.languageCode?"Undetermined":o.audioInfo.languageCode:"N/A"};d&&d.classList.add("hidden"),r&&r.classList.remove("hidden"),Object.keys(l).forEach(o=>{const e=i.querySelector(`[data-key="${o}"]`);if(e){e.textContent=l[o];const n=e.parentElement.querySelector(".copy-btn");n&&(n.dataset.value=l[o])}}),a.body.dataset.rawInfo=JSON.stringify(l)}catch(o){console.error("Failed to load video info:",o),d&&d.classList.add("hidden"),r&&r.classList.remove("hidden")}c.forEach(o=>{o.addEventListener("click",async()=>{const n=o.dataset.value;if(n)try{await navigator.clipboard.writeText(n),e._showToast("Copied to clipboard!")}catch(o){console.error("Failed to copy:",o)}})}),s&&s.addEventListener("click",async()=>{try{const o=JSON.parse(a.body.dataset.rawInfo||"{}"),n=`Video Information\n-----------------\nFilename: ${o.filename}\nFormat: ${o.format}\nMIME Type: ${o.mimeType}\nSize: ${o.size}\nDuration: ${o.duration}\n\nVideo Stream\n------------\nCodec: ${o.videoCodec} (${o.videoCodecString})\nResolution: ${o.resolution} (Coded: ${o.codedResolution})\nFrame Rate: ${o.fps}\nBitrate: ${o.videoBitrate}\nRotation: ${o.rotation}\nHDR: ${o.hdr}\n\nAudio Stream\n------------\nCodec: ${o.audioCodec} (${o.audioCodecString})\nChannels: ${o.channels}\nSample Rate: ${o.sampleRate}\nLanguage: ${o.language}\n`;await navigator.clipboard.writeText(n),e._showToast("All info copied to clipboard!")}catch(o){console.error("Failed to copy all:",o)}})}}