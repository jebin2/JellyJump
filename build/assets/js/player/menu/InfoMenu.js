import{Modal}from"../Modal.js";import{MediaProcessor}from"../../core/MediaProcessor.js";export class InfoMenu{static async init(e,o){const n=document.getElementById("info-content-template"),t=document.getElementById("info-footer-template");if(!n)return;const i=new Modal({maxWidth:"600px"});i.setTitle("Video Information"),i.setBody(n.content.cloneNode(!0)),t&&i.setFooter(t.content.cloneNode(!0));const a=i.modal,d=a.querySelector(".info-loading"),r=a.querySelector(".info-modal-content"),c=a.querySelectorAll(".copy-btn"),l=a.querySelector(".copy-all-btn");i.open();try{await o._ensureMetadata(e);const n=(e,o=1)=>{if(0===e)return"0 Bytes";const n=o<0?0:o,t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB"][t]};let t="Unknown";if(e.fileSize)t=n(e.fileSize);else if(e.file)t=n(e.file.size);else if(e.url)try{const o=(await fetch(e.url,{method:"HEAD"})).headers.get("content-length");o&&(t=n(parseInt(o)))}catch(e){t="Unknown"}let c="Unknown",l="Unknown";e.videoInfo&&(e.videoInfo.fps&&(c=`${e.videoInfo.fps} fps`),e.videoInfo.bitrate&&(l=`${(e.videoInfo.bitrate/1e6).toFixed(1)} Mbps`));const s=e.fileType||(e.file?e.file.type:"Unknown"),f="Unknown"!==s?s.split("/")[0]:"Unknown",u={filename:e.title,format:f,mimeType:s,size:t,duration:e.duration||"Unknown",videoCodec:e.videoInfo?e.videoInfo.codec.toUpperCase():"N/A",videoCodecString:e.videoInfo?e.videoInfo.codec:"N/A",resolution:e.videoInfo?`${e.videoInfo.width}x${e.videoInfo.height}`:"N/A",codedResolution:e.videoInfo?`${e.videoInfo.codedWidth}x${e.videoInfo.codedHeight}`:"N/A",fps:c,videoBitrate:l,rotation:e.videoInfo?`${e.videoInfo.rotation}Â°`:"N/A",hdr:e.videoInfo?e.videoInfo.hasHDR?"Yes":"No":"N/A",audioCodec:e.audioInfo?e.audioInfo.codec.toUpperCase():"N/A",audioCodecString:e.audioInfo?e.audioInfo.codec:"N/A",channels:e.audioInfo?2===e.audioInfo.channels?"Stereo (2)":`${e.audioInfo.channels} Channels`:"N/A",sampleRate:e.audioInfo?`${(e.audioInfo.sampleRate/1e3).toFixed(1)} kHz`:"N/A",language:e.audioInfo?"und"===e.audioInfo.languageCode?"Undetermined":e.audioInfo.languageCode:"N/A"};d&&d.classList.add("hidden"),r&&r.classList.remove("hidden"),Object.keys(u).forEach(e=>{const o=a.querySelector(`[data-key="${e}"]`);if(o){o.textContent=u[e];const n=o.parentElement.querySelector(".copy-btn");n&&(n.dataset.value=u[e])}}),i.body.dataset.rawInfo=JSON.stringify(u)}catch(e){console.error("Failed to load video info:",e),d&&d.classList.add("hidden"),r&&r.classList.remove("hidden")}c.forEach(e=>{e.addEventListener("click",async()=>{const n=e.dataset.value;if(n)try{await navigator.clipboard.writeText(n),o._showToast("Copied to clipboard!")}catch(e){console.error("Failed to copy:",e)}})}),l&&l.addEventListener("click",async()=>{try{const e=JSON.parse(i.body.dataset.rawInfo||"{}"),n=`Video Information\n-----------------\nFilename: ${e.filename}\nFormat: ${e.format}\nMIME Type: ${e.mimeType}\nSize: ${e.size}\nDuration: ${e.duration}\n\nVideo Stream\n------------\nCodec: ${e.videoCodec} (${e.videoCodecString})\nResolution: ${e.resolution} (Coded: ${e.codedResolution})\nFrame Rate: ${e.fps}\nBitrate: ${e.videoBitrate}\nRotation: ${e.rotation}\nHDR: ${e.hdr}\n\nAudio Stream\n------------\nCodec: ${e.audioCodec} (${e.audioCodecString})\nChannels: ${e.channels}\nSample Rate: ${e.sampleRate}\nLanguage: ${e.language}\n`;await navigator.clipboard.writeText(n),o._showToast("All info copied to clipboard!")}catch(e){console.error("Failed to copy all:",e)}})}}