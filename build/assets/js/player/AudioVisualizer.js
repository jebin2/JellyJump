export class AudioVisualizer{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.analyser=null,this.dataArray=null,this.animationId=null,this.isRunning=!1,this.raindrops=[],this.maxRaindrops=200,this.smoothing=.8,this.bassLevel=0,this.midLevel=0,this.highLevel=0,this.simulatedMode=!1,this.simulatedTime=0,console.log("[AudioVisualizer] Created for canvas:",t.width,"x",t.height)}connect(t,i){this.analyser=t.createAnalyser(),this.analyser.fftSize=256,this.analyser.smoothingTimeConstant=this.smoothing,i.connect(this.analyser),this.analyser.connect(t.destination);const s=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(s),this._initRaindrops(),console.log("[AudioVisualizer] Connected - Rain mode")}_initRaindrops(){this.raindrops=[];for(let t=0;t<this.maxRaindrops;t++)this.raindrops.push(this._createRaindrop())}_createRaindrop(){return{x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height-this.canvas.height,speed:2+3*Math.random(),length:10+20*Math.random(),opacity:.2+.5*Math.random(),thickness:1+2*Math.random()}}start(){this.isRunning||(this.analyser||(this.simulatedMode=!0,console.log("[AudioVisualizer] Starting in simulated mode")),this.isRunning=!0,this._initRaindrops(),this._animate(),console.log("[AudioVisualizer] Started"))}stop(){this.isRunning=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),console.log("[AudioVisualizer] Stopped")}_animate(){this.isRunning&&(this.animationId=requestAnimationFrame(()=>this._animate()),this._updateAudioLevels(),this._draw())}_updateAudioLevels(){if(this.simulatedMode||!this.analyser){this.simulatedTime+=.05;const t=(Math.sin(this.simulatedTime)+1)/2,i=(Math.sin(1.5*this.simulatedTime)+1)/2,s=(Math.sin(2.2*this.simulatedTime)+1)/2;return this.bassLevel=.3+.5*t,this.midLevel=.2+.4*i,void(this.highLevel=.1+.3*s)}this.analyser.getByteFrequencyData(this.dataArray);const t=this.dataArray.length;let i=0,s=0,a=0;const e=Math.floor(.15*t),h=Math.floor(.5*t);for(let n=0;n<t;n++)n<e?i+=this.dataArray[n]:n<h?s+=this.dataArray[n]:a+=this.dataArray[n];this.bassLevel=i/(255*e)*1.5,this.midLevel=s/(255*(h-e)),this.highLevel=a/(255*(t-h))}_draw(){const t=this.canvas.width,i=this.canvas.height,s=this.ctx.createLinearGradient(0,0,0,i);s.addColorStop(0,"#0a0a12"),s.addColorStop(1,"#1a1a2e"),this.ctx.fillStyle=s,this.ctx.fillRect(0,0,t,i);const a=1+4*this.bassLevel,e=(this.bassLevel+this.midLevel+this.highLevel)/3,h=Math.floor(this.maxRaindrops*(.3+.7*e));for(let s=0;s<Math.min(h,this.raindrops.length);s++){const h=this.raindrops[s];h.y+=h.speed*a,h.x+=2*(this.midLevel-.5),h.y>i&&(h.y=-h.length,h.x=Math.random()*t),h.x<0&&(h.x=t),h.x>t&&(h.x=0),this._drawRaindrop(h,e)}this._drawGroundEffect(e)}_drawRaindrop(t,i){const s=200+40*i,a=t.opacity*(.5+.5*i);this.ctx.beginPath(),this.ctx.strokeStyle=`hsla(${s}, 80%, 60%, ${a})`,this.ctx.lineWidth=t.thickness,this.ctx.lineCap="round",this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.x,t.y+t.length),this.ctx.stroke()}_drawGroundEffect(t){const i=this.canvas.width,s=this.canvas.height,a=60+40*t,e=this.ctx.createLinearGradient(0,s,0,s-a);if(e.addColorStop(0,`rgba(50, 150, 255, ${.1+.2*t})`),e.addColorStop(1,"transparent"),this.ctx.fillStyle=e,this.ctx.fillRect(0,s-a,i,a),t>.3){const a=Math.floor(10*t);for(let e=0;e<a;e++){const a=Math.random()*i,e=s-5-15*Math.random(),h=1+2*Math.random();this.ctx.beginPath(),this.ctx.arc(a,e,h,0,2*Math.PI),this.ctx.fillStyle=`rgba(100, 200, 255, ${.2+.3*t})`,this.ctx.fill()}}}disconnect(){this.stop(),this.analyser&&(this.analyser.disconnect(),this.analyser=null),this.dataArray=null,this.raindrops=[],console.log("[AudioVisualizer] Disconnected")}drawStaticBackground(){const t=this.canvas.width,i=this.canvas.height,s=this.ctx.createRadialGradient(t/2,i/2,0,t/2,i/2,Math.max(t,i)/2);s.addColorStop(0,"#1a1a2e"),s.addColorStop(1,"#0a0a12"),this.ctx.fillStyle=s,this.ctx.fillRect(0,0,t,i);for(let s=0;s<50;s++){const s=Math.random()*t,a=Math.random()*i,e=10+15*Math.random();this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(100, 180, 255, ${.1+.2*Math.random()})`,this.ctx.lineWidth=1,this.ctx.moveTo(s,a),this.ctx.lineTo(s,a+e),this.ctx.stroke()}this.ctx.save(),this.ctx.translate(t/2,i/2-20),this.ctx.fillStyle="rgba(100, 200, 255, 0.6)",this.ctx.font=Math.min(t,i)/4+"px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("â™ª",0,0),this.ctx.restore(),this.ctx.fillStyle="rgba(150, 200, 255, 0.5)",this.ctx.font="14px sans-serif",this.ctx.textAlign="center",this.ctx.fillText("Press play to start",t/2,i/2+50)}}